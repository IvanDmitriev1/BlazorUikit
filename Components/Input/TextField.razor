@namespace BlazorUiKit.Components
@inherits UiKitInputBase<string>

@inject IJSRuntime JsRuntime

<InputField Label="@Label"
            Class="@Class"
            Disabled="@Disabled"
            AdornmentPlacement="@AdornmentPlacement"
            For="ValueExpression"
            IsInvalid="@(CssClass == "invalid")">
    <AdornmentRenderFragment>
        <InputAdornment Icon="@AdornmentIcon" Size="@AdornmentSize"  AdornmentPlacement="@AdornmentPlacement" AdornmentClick="@AdornmentClick" />
    </AdornmentRenderFragment>
    
    <InputRenderFragment>
        <UiTextInput @attributes="@AdditionalAttributes"
                     @ref="TextInput"
                     AdornmentPlacement="AdornmentPlacement"
                     NameAttributeValue="@NameAttributeValue"
                     DebounceInterval="DebounceInterval"
                     Immediate="Immediate"
                     InputType="InputType"
                     ReadOnly="ReadOnly"
                     Disabled="Disabled"
                     Placeholder="@Placeholder"

                     Text="@Value"
                     TextChanged="text=> CurrentValue = text"/>
    </InputRenderFragment>
</InputField>

@code
{
    [Parameter]
    public bool FullWidth { get; set; }

    [Parameter]
    public bool Immediate { get; set; }

    [Parameter]
    public TimeSpan DebounceInterval { get; set; }

    [Parameter]
    public InputType InputType { get; set; } = InputType.Text;


    [Parameter]
    public AdornmentPlacement AdornmentPlacement { get; set; }

    [Parameter]
    public TablerIcon AdornmentIcon { get; set; }

    [Parameter]
    public Size AdornmentSize { get; set; } = Size.Medium;

    [Parameter]
    public EventCallback AdornmentClick { get; set; }

    [JSInvokable]
    public void ChangeCurrentText(string newValue)
    {
        CurrentValue = newValue;
    }

    protected override bool TryParseValueFromString(string? value, out string result, [NotNullWhen(false)] out string? validationErrorMessage)
    {
        result = value ?? string.Empty;
        validationErrorMessage = null;
        return true;
    }
}
