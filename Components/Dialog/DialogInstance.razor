@namespace BlazorUiKit.Components
@inherits UiKitRenderComponentBase

@inject IJSRuntime JsRuntime

<dialog @ref="_element"
        id="@DialogReference.Id"
        class="@ComponentCss"
        @onclose="DialogReference.Cancel">
    <CascadingValue IsFixed="true" Value="DialogReference">
        @if (DialogReference.DisplayOptions.HeadLess)
        {
            @DialogReference.DialogContent
        }
        else
        {
            <DialogHeader Options="DialogReference.DisplayOptions" Id="@DialogReference.Id.ToString()"/>
            
            @DialogReference.DialogContent
        }
    </CascadingValue>
</dialog>

@code
{
    [Parameter, EditorRequired]
    public IDialogReferenceBase DialogReference { get; set; } = null!;

    ElementReference _element;

    protected override void AddComponentCssClasses(ref CssBuilder cssBuilder)
    {
        cssBuilder.AddDialogInstanceStyle();
        cssBuilder.AddClass("animate-zoom");
        cssBuilder.AddClass(DialogReference.DisplayOptions.MaxWidthBreakpoint.ToTailwindCssMaxWidth());
    }

    protected override Task OnFirstRenderAsync() => JsRuntime.InvokeVoidAsync("OpenModalDialog", _element, DialogReference.DisplayOptions.PreventDismissOnOverlayClick).AsTask();
}
