@namespace BlazorUiKit.Components
@inherits UiKitComponentBase

<Element @attributes="@UserAttributes"
         Class="@ComponentCss"
         HtmlTag="@HtmlTag"
         type="@Type.ToHtml()"
         href="@Href"
         target="@HrefTarget.ToHtml()"
         disabled="@Disabled">
    
    @if (IconPosition == ButtonIconPosition.Left)
    {
        @IconRenderFragment
    }
    
    @if (IconPosition == ButtonIconPosition.Content && Icon != TablerIcon.None)
    {
        @IconRenderFragment
    }
    else
    {
        @ChildContent
    }
    
    @if (IconPosition == ButtonIconPosition.Right)
    {
        @IconRenderFragment
    }
</Element>

@code
{
    [Parameter(CaptureUnmatchedValues = true)]
    public Dictionary<string, object>? UserAttributes { get; set; }
    
    [Parameter]
    public RenderFragment? ChildContent { get; set; }

    [Parameter]
    public string? Href { get; set; }

    [Parameter]
    public HrefTarget HrefTarget { get; set; } = HrefTarget.Self;

    [Parameter]
    public bool Disabled { get; set; }

    [Parameter]
    public ButtonType Type { get; set; } = ButtonType.Button;

    [Parameter]
    public Color Color { get; set; } = Color.Primary;

    [Parameter]
    public Variant Variant { get; set; } = Variant.Filled;

    [Parameter]
    public Size Size { get; set; } = Size.Medium;

    [Parameter]
    public TablerIcon Icon { get; set; } = TablerIcon.None;

    [Parameter]
    public ButtonIconPosition IconPosition { get; set; } = ButtonIconPosition.Content;

    private RenderFragment IconRenderFragment =>
        @<UiKitIcon Class="@_iconCss" Icon="Icon" Size="Size"/>;

    private string HtmlTag { get; set; } = "button";
    
    private string? _iconCss;
    
    protected override void OnInitialized()
    {
        _iconCss = IconPosition switch
        {
            ButtonIconPosition.Content => null,
            ButtonIconPosition.Left => "mr-2.5",
            ButtonIconPosition.Right => "ml-2.5",
            _ => throw new ArgumentOutOfRangeException()
        };
    }

    protected override void OnParametersSet()
    {
        if (Disabled)
        {
            HtmlTag = "button";
            Href = null;
            return;
        }

        if (!string.IsNullOrWhiteSpace(Href))
        {
            HtmlTag = "a";
        }
    }

    protected override void AddComponentCssClasses(ref CssBuilder cssBuilder)
    {
        cssBuilder.AddClass("inline-flex justify-center items-center");
        cssBuilder.AddClass("focus:ring focus:outline-none");
        cssBuilder.AddClass("transition duration-300");
        cssBuilder.AddClass("select-none rounded");
        cssBuilder.AddClass("border border-dark-gray-5 shadow-sm", Variant == Variant.Filled);

        cssBuilder.AddClass(Size switch{
            Size.Custom => string.Empty,
            Size.Small => "py-2.5 px-3",
            Size.Medium => "py-4 px-5 font-bold",
            Size.Large => "py-5 px-6 font-bold text-header",
            _ => throw new ArgumentOutOfRangeException()}, IconPosition != ButtonIconPosition.Content || Icon == TablerIcon.None);
        
        cssBuilder.AddClass("p-1.5", Icon != TablerIcon.None && IconPosition == ButtonIconPosition.Content);
        
        cssBuilder.AddClass(ThemeManager.ThemeProvider.BackgroundDisabledCss, Disabled);
        cssBuilder.AddClass(ThemeManager.ThemeProvider.TextDisabledCss, Disabled);

        if (Disabled)
        {
            return;
        }

        var swappedColor = Color == Color.Primary ? Color.Secondary : Color;
        
        cssBuilder.AddClass(ThemeManager.ThemeProvider.ToBackgroundCss(Color), Variant == Variant.Filled);
        cssBuilder.AddClass(ThemeManager.ThemeProvider.ToBackgroundHoverCss(swappedColor));
        cssBuilder.AddClass(ThemeManager.ThemeProvider.ToBackgroundActiveCss(Color));
            
        cssBuilder.AddClass(ThemeManager.ThemeProvider.ToRingFocusCss(Color));
        cssBuilder.AddClass(ThemeManager.ThemeProvider.ToTextCss(Color));
        cssBuilder.AddClass(ThemeManager.ThemeProvider.ToTextHoverCss(swappedColor));
        cssBuilder.AddClass(ThemeManager.ThemeProvider.ToTextActiveCss(Color));
    }
}
