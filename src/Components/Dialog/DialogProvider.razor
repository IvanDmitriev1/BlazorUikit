@namespace BlazorUiKit.Components
@inherits UiKitRenderComponentBase

@inject IDialogService DialogService

@foreach (var (key, dialogReference) in DialogService.DialogsById)
{
    <DialogInstance @key="key" DialogReference="dialogReference"/>
}

@code
{
    protected override void AddComponentCssClasses(ref CssBuilder cssBuilder) { }

    public void Refresh() => StateHasChangedWithRendering();
    public Task RefreshAsync() => InvokeAsync(StateHasChangedWithRendering);

    protected override void OnInitialized()
    {
        DialogService.AddDialogProvider(this);
    }

    private ValueTask OnLocationChanging(LocationChangingContext arg)
    {
        if (DialogService.DialogsById.Count == 0)
            return ValueTask.CompletedTask;

        foreach (var (_, dialogReferenceBase) in DialogService.DialogsById)
        {
            dialogReferenceBase.Cancel();
        }

        return ValueTask.CompletedTask;
    }
}
