@namespace BlazorUiKit.Components
@inherits UiKitRenderComponentBase

@inject IJSRuntime JsRuntime

<dialog @ref="_element" class="@ComponentCss" @onclose="OverlayOnClickHandler">
    <CascadingValue IsFixed="true" Value="DialogReference">
                @DialogReference.DialogContent
    </CascadingValue>
</dialog>

@code
{
    [Parameter, EditorRequired]
    public IDialogReferenceBase DialogReference { get; set; } = null!;

    ElementReference _element;

    protected override void AddComponentCssClasses(ref CssBuilder cssBuilder)
    {
        cssBuilder.AddClass("container p-5");
        cssBuilder.AddClass("cursor-default animate-zoom");
        cssBuilder.AddClass("rounded border-2 drop-shadow-md");
        cssBuilder.AddClass(ThemeManager.ThemeProvider.ToBorderCss(Color.Secondary));
        cssBuilder.AddClass(DialogReference.DisplayOptions.Breakpoint.ToTailwindCssMaxWidth());
        cssBuilder.AddClass(ThemeManager.ThemeProvider.PageBackgroundCss);
        cssBuilder.AddClass(ThemeManager.ThemeProvider.PageTextCss);
        
        cssBuilder.AddClass("backdrop:bg-main-dark-background/60");
        cssBuilder.AddClass("backdrop:cursor-pointer", DialogReference.DisplayOptions.DismissOnBackdropClick);
    }

    protected override async Task OnFirstRenderAsync()
    {
        await JsRuntime.InvokeVoidAsync("OpenModalDialog", _element);
    }

    private void OverlayOnClickHandler()
    {
        if (!DialogReference.DisplayOptions.DismissOnBackdropClick)
            return;

        DialogReference.Cancel();
    }
}
